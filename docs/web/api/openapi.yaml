openapi: 3.1.1
info:
  description: profile-svc docs
  title: NetBill profile service
  version: 0.1.0
servers:
- url: http://localhost:8002
paths:
  /profiles-svc/v1/profiles/:
    get:
      description: |
        Returns a paginated list of public profiles filtered by optional query parameters. Supports prefix-based filtering for `username` and `pseudonym`.
      parameters:
      - description: Prefix filter for username.
        explode: true
        in: query
        name: username_like
        required: false
        schema:
          minLength: 1
          type: string
        style: form
      - description: Prefix filter for pseudonym.
        explode: true
        in: query
        name: pseudonym
        required: false
        schema:
          minLength: 1
          type: string
        style: form
      - description: Maximum number of items to return.
        explode: true
        in: query
        name: limit
        required: false
        schema:
          maximum: 100
          minimum: 1
          type: integer
        style: form
      - description: Number of items to skip.
        explode: true
        in: query
        name: offset
        required: false
        schema:
          minimum: 0
          type: integer
        style: form
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProfilesCollection"
          description: Profiles list.
        "500":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Internal server error.
      summary: Filter profiles
      tags:
      - Profiles
  /profiles-svc/v1/profiles/u/{username}:
    get:
      description: |
        Returns a public profile by `username`. If the profile does not exist, responds with 404.
      parameters:
      - description: Username of the profile owner.
        explode: false
        in: path
        name: username
        required: true
        schema:
          minLength: 1
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Profile"
          description: Profile found.
        "404":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Profile for user does not exist.
        "500":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Internal server error.
      summary: Get profile by username
      tags:
      - Profiles
  /profiles-svc/v1/profiles/me/:
    get:
      description: |
        Returns the current authenticated user's profile. Requires a valid access token.
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Profile"
          description: Profile found.
        "401":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Unauthorized.
        "500":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Internal server error.
      security:
      - bearerAuth: []
      summary: Get my profile
      tags:
      - Profiles
    put:
      description: |
        Updates the current authenticated user's profile. The request body must contain the same `data.id` as the authenticated account id.
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProfile"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Profile"
          description: Profile updated.
        "400":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Bad request (validation error / invalid payload).
        "401":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Unauthorized (missing/invalid token or profile does not exist).
        "403":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Forbidden (user too young).
        "500":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Internal server error.
      security:
      - bearerAuth: []
      summary: Update my profile
      tags:
      - Profiles
  /profiles-svc/v1/profiles/{account_id}:
    get:
      description: |
        Returns a public profile by `account_id` (UUID). If the profile does not exist, responds with 404.
      parameters:
      - description: Account id (UUID).
        explode: false
        in: path
        name: account_id
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Profile"
          description: Profile found.
        "400":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Bad request (invalid account_id).
        "404":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Profile for account does not exist.
        "500":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Internal server error.
      summary: Get profile by account id
      tags:
      - Profiles
  /profiles-svc/v1/profiles/{account_id}/official:
    patch:
      description: |
        Updates the `official` status of a profile by profile id.
      parameters:
      - description: Account id (UUID).
        explode: false
        in: path
        name: account_id
        required: true
        schema:
          format: uuid
          type: string
        style: simple
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UpdateProfileOfficial"
        required: true
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Profile"
          description: Official status updated.
        "400":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Bad request (invalid payload / validation error).
        "404":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Profile for account does not exist.
        "500":
          content:
            application/problem+json:
              schema:
                $ref: "#/components/schemas/Errors"
          description: Internal server error.
      security:
      - bearerAuth: []
      summary: Update profile official status
      tags:
      - Profiles
components:
  schemas:
    CreateProfile:
      properties:
        data:
          $ref: "#/components/schemas/CreateProfile_data"
      required:
      - data
    UpdateProfile:
      example:
        data:
          attributes:
            description: description
            pseudonym: pseudonym
          id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
          type: update_profile
      properties:
        data:
          $ref: "#/components/schemas/UpdateProfile_data"
      required:
      - data
    UpdateProfileOfficial:
      example:
        data:
          attributes:
            official: true
          id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
          type: update_profile_official
      properties:
        data:
          $ref: "#/components/schemas/UpdateProfileOfficial_data"
      required:
      - data
    Profile:
      example:
        data:
          attributes:
            updated_at: 2000-01-23T04:56:07.000+00:00
            description: description
            official: true
            created_at: 2000-01-23T04:56:07.000+00:00
            pseudonym: pseudonym
            username: username
          id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
          type: profile
      properties:
        data:
          $ref: "#/components/schemas/ProfileData"
      required:
      - data
    ProfileData:
      example:
        attributes:
          updated_at: 2000-01-23T04:56:07.000+00:00
          description: description
          official: true
          created_at: 2000-01-23T04:56:07.000+00:00
          pseudonym: pseudonym
          username: username
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        type: profile
      properties:
        id:
          description: account id
          format: uuid
          type: string
        type:
          enum:
          - profile
          type: string
        attributes:
          $ref: "#/components/schemas/ProfileAttributes"
      required:
      - attributes
      - id
      - type
    ProfileAttributes:
      example:
        updated_at: 2000-01-23T04:56:07.000+00:00
        description: description
        official: true
        created_at: 2000-01-23T04:56:07.000+00:00
        pseudonym: pseudonym
        username: username
      properties:
        username:
          description: Username
          type: string
        pseudonym:
          description: Pseudonym
          type: string
        description:
          description: Description
          type: string
        official:
          description: Is Official Account
          type: boolean
        updated_at:
          description: Updated At
          format: date-time
          type: string
        created_at:
          description: Created At
          format: date-time
          type: string
      required:
      - created_at
      - official
      - updated_at
      - username
    ProfilesCollection:
      example:
        data:
        - attributes:
            updated_at: 2000-01-23T04:56:07.000+00:00
            description: description
            official: true
            created_at: 2000-01-23T04:56:07.000+00:00
            pseudonym: pseudonym
            username: username
          id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
          type: profile
        - attributes:
            updated_at: 2000-01-23T04:56:07.000+00:00
            description: description
            official: true
            created_at: 2000-01-23T04:56:07.000+00:00
            pseudonym: pseudonym
            username: username
          id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
          type: profile
        links:
          next: https://openapi-generator.tech
          last: https://openapi-generator.tech
          prev: https://openapi-generator.tech
          self: https://openapi-generator.tech
          first: https://openapi-generator.tech
      properties:
        data:
          items:
            $ref: "#/components/schemas/ProfileData"
          type: array
        links:
          $ref: "#/components/schemas/PaginationData"
      required:
      - data
      - links
    Errors:
      description: Standard JSON:API error
      properties:
        errors:
          description: Non empty array of errors occurred during request processing
          items:
            $ref: "#/components/schemas/Errors_errors_inner"
          type: array
      required:
      - errors
    PaginationData:
      example:
        next: https://openapi-generator.tech
        last: https://openapi-generator.tech
        prev: https://openapi-generator.tech
        self: https://openapi-generator.tech
        first: https://openapi-generator.tech
      properties:
        self:
          description: link to the current page
          format: uri
          type: string
        first:
          description: link to the first page
          format: uri
          type: string
        last:
          description: link to the last page
          format: uri
          type: string
        prev:
          description: link to the previous page
          format: uri
          type: string
        next:
          description: link to the next page
          format: uri
          type: string
      required:
      - self
    CreateProfile_data_attributes:
      properties:
        username:
          description: Username
          type: string
        pseudonym:
          description: Pseudonym
          type: string
        description:
          description: Description
          type: string
      required:
      - username
    CreateProfile_data:
      properties:
        id:
          description: account id
          format: uuid
          type: string
        type:
          enum:
          - create_profile
          type: string
        attributes:
          $ref: "#/components/schemas/CreateProfile_data_attributes"
      required:
      - attributes
      - id
      - type
    UpdateProfile_data_attributes:
      example:
        description: description
        pseudonym: pseudonym
      properties:
        pseudonym:
          description: Pseudonym
          type: string
        description:
          description: Description
          type: string
    UpdateProfile_data:
      example:
        attributes:
          description: description
          pseudonym: pseudonym
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        type: update_profile
      properties:
        id:
          description: account id
          format: uuid
          type: string
        type:
          enum:
          - update_profile
          type: string
        attributes:
          $ref: "#/components/schemas/UpdateProfile_data_attributes"
      required:
      - attributes
      - id
      - type
    UpdateProfileOfficial_data_attributes:
      example:
        official: true
      properties:
        official:
          description: official
          type: boolean
      required:
      - official
    UpdateProfileOfficial_data:
      example:
        attributes:
          official: true
        id: 046b6c7f-0b8a-43b9-b35d-6489e6daee91
        type: update_profile_official
      properties:
        id:
          description: account id
          format: uuid
          type: string
        type:
          enum:
          - update_profile_official
          type: string
        attributes:
          $ref: "#/components/schemas/UpdateProfileOfficial_data_attributes"
      required:
      - attributes
      - id
      - type
    Errors_errors_inner:
      properties:
        title:
          description: "Title is a short, human-readable summary of the problem"
          example: Bad Request
          type: string
        detail:
          description: Detail is a human-readable explanation specific to this occurrence
            of the problem
          example: Request body was expected
          type: string
        status:
          description: Status is the HTTP status code applicable to this problem
          enum:
          - 400
          - 401
          - 403
          - 404
          - 409
          - 500
          example: 400
          type: integer
      required:
      - status
      - title
